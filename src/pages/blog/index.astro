---
import { getCollection} from "astro:content"

import MainLayout from "../../layouts/MainLayout.astro"
import Blog from "../../components/Blog/index.astro"
import type { PostPreview } from "../../components/Blog/types"

const posts = await getCollection("blog", post => !post.data.draft)
const sorted = posts.sort((l, r) => r.data.date.getTime() - l.data.date.getTime())

const previews: PostPreview[] = sorted.map(post => {
  return {
    title: post.data.title,
    date: post.data.date,
    slug: post.slug,
    description: post.data.description,
    categories: post.data.categories,
    cover: post.data.cover,
    readingTime: ""
  }
}).slice(0, 9)

const pager = {
  total: Math.ceil(posts.length / 9),
  currentPage: 1
}
---

<MainLayout>
  <Blog posts={previews} pager={pager} />
</MainLayout>
